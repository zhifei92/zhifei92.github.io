I"¶H<h1 id="è¯´æ˜">è¯´æ˜</h1>
<p>ç”±äºå·¥ä½œçš„å¥‘æœºï¼Œæœ€è¿‘å­¦ä¹ äº†ä¸‹Gossipï¼Œä»¥åŠgoè¯­è¨€çš„å®ç°ç‰ˆæœ¬HashiCorp/memberlistã€‚ç½‘ä¸Šæœ‰ä¸ªæœ€åŸºæœ¬çš„memberlistä½¿ç”¨çš„exampleï¼Œåœ¨ä¸‹è¾¹çš„é“¾æ¥ä¸­ï¼Œæ„Ÿå…´è¶£å¯ä»¥æŒ‰ç…§æ–‡æ¡£è¿è¡Œä¸‹æ„Ÿå—æ„Ÿå—ã€‚æœ¬æ–‡ä¸»è¦è®²è§£memberlist <a href="https://github.com/hashicorp/memberlist/releases/tag/v0.1.5">v0.1.5</a> çš„ä½¿ç”¨ç»†èŠ‚ã€‚</p>
<h1 id="gossip">Gossip</h1>
<p>Gossipæ˜¯æœ€ç»ˆä¸€è‡´æ€§åè®®ï¼Œæœ‰å¾ˆå¥½çš„å®¹é”™æ€§ã€å¥å£®æ€§ã€‚ç›®å‰Prometheusçš„å‘Šè­¦ç»„ä»¶alertmanagerã€redisã€s3ã€åŒºå—é“¾ç­‰é¡¹ç›®éƒ½æœ‰ä½¿ç”¨Gossipã€‚æœ¬æ–‡ä¸ä»‹ç»GossipåŸç†ï¼Œå¤§å®¶è‡ªè¡Œè°·æ­Œã€‚</p>
<h1 id="example">example</h1>
<p>ç®€å•çš„å‡ æ­¥å³å¯æ­å»ºgossipé›†ç¾¤</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1ã€newä¸ªé…ç½®æ–‡ä»¶
c := memberlist.DefaultLocalConfig()
2ã€åˆ›å»ºgossipç½‘ç»œ
m, err := memberlist.Create(c)
3ã€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤
m.Join(parts)
4ã€å®ç°delegateæ¥å£
5ã€å°†æˆ‘ä»¬éœ€è¦åŒæ­¥çš„æ•°æ®åŠ åˆ°å¹¿æ’­é˜Ÿåˆ—
broadcasts.QueueBroadcast(userdate)
</code></pre></div></div>
<p>æ„Ÿè°¢å·²ç»æœ‰ç½‘å‹ä¸ºæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªexampleï¼ˆ<a href="https://github.com/asim/memberlist">https://github.com/asim/memberlist</a>
ï¼‰ã€‚</p>
<h1 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h1>
<ol>
  <li>æˆ‘ä»¬ä¸memberlistäº¤äº’å°±æ˜¯è¿™ä¸ªConfig é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢åŒ…æ‹¬åŸºæœ¬é…ç½®BindAddr ã€BindPort ï¼Œä¼˜åŒ–é…ç½®GossipIntervalã€ GossipNodesï¼Œä»£ç†æ¥å£Delegateã€EventDelegateã€‚memberlistç»™äº†æˆ‘ä»¬ä¸‰ä¸ªé»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬ä¸åšä»»ä½•ä¿®æ”¹ï¼Œç›´æ¥åˆ›å»ºé»˜è®¤é…ç½®å³å¯ä»¥ç®€å•çš„è·‘å¯ä¸€ä¸ªgossipé›†ç¾¤ã€‚å±€åŸŸç½‘ç»œçš„é…ç½®DefaultLANConfigï¼Œå¤–ç½‘DefaultWANConfigï¼Œæœ¬åœ°DefaultLocalConfigï¼Œåä¸¤è€…éƒ½æ˜¯åœ¨DefaultLANConfig
åŸºç¡€ä¸Šä¿®æ”¹ï¼ŒåŒºåˆ«æ˜¯æ ¹æ®ç½‘é€Ÿï¼Œè°ƒæ•´äº†gossip intervalã€tcptimeoutè¶…æ—¶æ—¶é—´ç­‰ã€‚</li>
  <li>æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»ä¸‹Configçš„å„ä¸ªé…ç½®é¡¹ï¼Œä»¥ä¾¿å¤§å®¶åœ¨ä½¿ç”¨memberlistæ—¶ï¼Œèƒ½å¤ŸçŸ¥é“å“ªä¸ªå‚æ•°åº”è¯¥ä¿®æ”¹ï¼Œå“ªä¸ªä»£ç†éœ€è¦å®ç°ã€‚
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type Config struct {
 // The name of this node. This must be unique in the cluster.
 Name string

 // Transport is a hook for providing custom code to communicate with
 // other nodes. If this is left nil, then memberlist will by default
 // make a NetTransport using BindAddr and BindPort from this structure.
 Transport Transport

 // Configuration related to what address to bind to and ports to
 // listen on. The port is used for both UDP and TCP gossip. It is
 // assumed other nodes are running on this port, but they do not need
 // to.
 BindAddr string
 BindPort int

 // Configuration related to what address to advertise to other
 // cluster members. Used for nat traversal.
 AdvertiseAddr string
 AdvertisePort int

 // ProtocolVersion is the configured protocol version that we
 // will _speak_. This must be between ProtocolVersionMin and
 // ProtocolVersionMax.
 ProtocolVersion uint8

 // TCPTimeout is the timeout for establishing a stream connection with
 // a remote node for a full state sync, and for stream read and write
 // operations. This is a legacy name for backwards compatibility, but
 // should really be called StreamTimeout now that we have generalized
 // the transport.
 TCPTimeout time.Duration

 /* IndirectChecks is the number of nodes that will be asked to perform
  an indirect probe of a node in the case a direct probe fails. Memberlist
  waits for an ack from any single indirect node, so increasing this
  number will increase the likelihood that an indirect probe will succeed
  at the expense of bandwidth. */
 IndirectChecks int

 // RetransmitMult is the multiplier for the number of retransmissions
 // that are attempted for messages broadcasted over gossip. The actual
 // count of retransmissions is calculated using the formula:
 //
 //   Retransmits = RetransmitMult * log(N+1)
 //
 // This allows the retransmits to scale properly with cluster size. The
 // higher the multiplier, the more likely a failed broadcast is to converge
 // at the expense of increased bandwidth.
 RetransmitMult int

 // SuspicionMult is the multiplier for determining the time an
 // inaccessible node is considered suspect before declaring it dead.
 // The actual timeout is calculated using the formula:
 //
 //   SuspicionTimeout = SuspicionMult * log(N+1) * ProbeInterval
 //
 // This allows the timeout to scale properly with expected propagation
 // delay with a larger cluster size. The higher the multiplier, the longer
 // an inaccessible node is considered part of the cluster before declaring
 // it dead, giving that suspect node more time to refute if it is indeed
 // still alive.
 SuspicionMult int

 // SuspicionMaxTimeoutMult is the multiplier applied to the
 // SuspicionTimeout used as an upper bound on detection time. This max
 // timeout is calculated using the formula:
 //
 // SuspicionMaxTimeout = SuspicionMaxTimeoutMult * SuspicionTimeout
 //
 // If everything is working properly, confirmations from other nodes will
 // accelerate suspicion timers in a manner which will cause the timeout
 // to reach the base SuspicionTimeout before that elapses, so this value
 // will typically only come into play if a node is experiencing issues
 // communicating with other nodes. It should be set to a something fairly
 // large so that a node having problems will have a lot of chances to
 // recover before falsely declaring other nodes as failed, but short
 // enough for a legitimately isolated node to still make progress marking
 // nodes failed in a reasonable amount of time.
 SuspicionMaxTimeoutMult int

 // PushPullInterval is the interval between complete state syncs.
 // Complete state syncs are done with a single node over TCP and are
 // quite expensive relative to standard gossiped messages. Setting this
 // to zero will disable state push/pull syncs completely.
 //
 // Setting this interval lower (more frequent) will increase convergence
 // speeds across larger clusters at the expense of increased bandwidth
 // usage.
 PushPullInterval time.Duration

 // ProbeInterval and ProbeTimeout are used to configure probing
 // behavior for memberlist.
 //
 // ProbeInterval is the interval between random node probes. Setting
 // this lower (more frequent) will cause the memberlist cluster to detect
 // failed nodes more quickly at the expense of increased bandwidth usage.
 //
 // ProbeTimeout is the timeout to wait for an ack from a probed node
 // before assuming it is unhealthy. This should be set to 99-percentile
 // of RTT (round-trip time) on your network.
 ProbeInterval time.Duration
 ProbeTimeout  time.Duration

 // DisableTcpPings will turn off the fallback TCP pings that are attempted
 // if the direct UDP ping fails. These get pipelined along with the
 // indirect UDP pings.
 DisableTcpPings bool

 // AwarenessMaxMultiplier will increase the probe interval if the node
 // becomes aware that it might be degraded and not meeting the soft real
 // time requirements to reliably probe other nodes.
 AwarenessMaxMultiplier int

 // GossipInterval and GossipNodes are used to configure the gossip
 // behavior of memberlist.
 //
 // GossipInterval is the interval between sending messages that need
 // to be gossiped that haven't been able to piggyback on probing messages.
 // If this is set to zero, non-piggyback gossip is disabled. By lowering
 // this value (more frequent) gossip messages are propagated across
 // the cluster more quickly at the expense of increased bandwidth.
 //
 // GossipNodes is the number of random nodes to send gossip messages to
 // per GossipInterval. Increasing this number causes the gossip messages
 // to propagate across the cluster more quickly at the expense of
 // increased bandwidth.
 //
 // GossipToTheDeadTime is the interval after which a node has died that
 // we will still try to gossip to it. This gives it a chance to refute.
 GossipInterval      time.Duration
 GossipNodes         int
 GossipToTheDeadTime time.Duration

 // GossipVerifyIncoming controls whether to enforce encryption for incoming
 // gossip. It is used for upshifting from unencrypted to encrypted gossip on
 // a running cluster.
 GossipVerifyIncoming bool

 // GossipVerifyOutgoing controls whether to enforce encryption for outgoing
 // gossip. It is used for upshifting from unencrypted to encrypted gossip on
 // a running cluster.
 GossipVerifyOutgoing bool

 // EnableCompression is used to control message compression. This can
 // be used to reduce bandwidth usage at the cost of slightly more CPU
 // utilization. This is only available starting at protocol version 1.
 EnableCompression bool

 // SecretKey is used to initialize the primary encryption key in a keyring.
 // The primary encryption key is the only key used to encrypt messages and
 // the first key used while attempting to decrypt messages. Providing a
 // value for this primary key will enable message-level encryption and
 // verification, and automatically install the key onto the keyring.
 // The value should be either 16, 24, or 32 bytes to select AES-128,
 // AES-192, or AES-256.
 SecretKey []byte

 // The keyring holds all of the encryption keys used internally. It is
 // automatically initialized using the SecretKey and SecretKeys values.
 Keyring *Keyring

 // Delegate and Events are delegates for receiving and providing
 // data to memberlist via callback mechanisms. For Delegate, see
 // the Delegate interface. For Events, see the EventDelegate interface.
 //
 // The DelegateProtocolMin/Max are used to guarantee protocol-compatibility
 // for any custom messages that the delegate might do (broadcasts,
 // local/remote state, etc.). If you don't set these, then the protocol
 // versions will just be zero, and version compliance won't be done.
 Delegate                Delegate
 DelegateProtocolVersion uint8
 DelegateProtocolMin     uint8
 DelegateProtocolMax     uint8
 Events                  EventDelegate
 Conflict                ConflictDelegate
 Merge                   MergeDelegate
 Ping                    PingDelegate
 Alive                   AliveDelegate

 // DNSConfigPath points to the system's DNS config file, usually located
 // at /etc/resolv.conf. It can be overridden via config for easier testing.
 DNSConfigPath string

 // LogOutput is the writer where logs should be sent. If this is not
 // set, logging will go to stderr by default. You cannot specify both LogOutput
 // and Logger at the same time.
 LogOutput io.Writer

 // Logger is a custom logger which you provide. If Logger is set, it will use
 // this for the internal logger. If Logger is not set, it will fall back to the
 // behavior for using LogOutput. You cannot specify both LogOutput and Logger
 // at the same time.
 Logger *log.Logger

 // Size of Memberlist's internal channel which handles UDP messages. The
 // size of this determines the size of the queue which Memberlist will keep
 // while UDP messages are handled.
 HandoffQueueDepth int

 // Maximum number of bytes that memberlist will put in a packet (this
 // will be for UDP packets by default with a NetTransport). A safe value
 // for this is typically 1400 bytes (which is the default). However,
 // depending on your network's MTU (Maximum Transmission Unit) you may
 // be able to increase this to get more content into each gossip packet.
 // This is a legacy name for backward compatibility but should really be
 // called PacketBufferSize now that we have generalized the transport.
 UDPBufferSize int

 // DeadNodeReclaimTime controls the time before a dead node's name can be
 // reclaimed by one with a different address or port. By default, this is 0,
 // meaning nodes cannot be reclaimed this way.
 DeadNodeReclaimTime time.Duration
}
</code></pre></div>    </div>
  </li>
</ol>

<h5 id="é…ç½®é¡¹è§£é‡Š">é…ç½®é¡¹è§£é‡Š</h5>
<ul>
  <li>Nameï¼šèŠ‚ç‚¹åå­—ï¼Œåœ¨é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€ï¼ˆæŸ¥è¯¢èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ï¼‰ï¼Œå¯ä»¥åœ¨hostnameååŠ ä¸ªuuidç­‰ã€‚</li>
  <li>Transportï¼šèŠ‚ç‚¹é—´é€šä¿¡çš„åŸºç¡€æœåŠ¡ï¼ŒåŒ…æ‹¬tcpã€udpã€‚ä¸å®ç°è¿™ä¸ªæ¥å£ï¼Œé»˜è®¤ä½¿ç”¨memberlistæä¾›çš„NetTransportã€‚è¿™ä¸ªåŸºæœ¬ä¸ç”¨é…ç½®ï¼Œ<strong>åªæœ‰å®˜æ–¹æä¾›çš„åŠŸèƒ½æ»¡è¶³ä¸äº†ä½ çš„æ—¶å€™ï¼ŒæŠŠæºç ç†è§£é€äº†ï¼Œåœ¨è€ƒè™‘è‡ªå®šä¹‰è¿™ä¸ªæ¥å£</strong>ã€‚</li>
  <li>BindAddrã€BindPortï¼šè¿™ä¸¤ä¸ªå¾ˆç®€å•ï¼Œå°±æ˜¯gossip peerç»‘å®šçš„åœ°å€ï¼Œæ–°èŠ‚ç‚¹å¯ä»¥é€šè¿‡é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„
BindAddrã€BindPortåŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚é»˜è®¤â€0.0.0.0â€ã€â€˜7946â€™, BindPortå¦‚æœé…ç½®æˆâ€˜0â€™ï¼Œmemberlistä¼šåŠ¨æ€ç»‘å®šä¸€ä¸ªç«¯å£ã€‚</li>
  <li>AdvertiseAddrã€AdvertisePortï¼šè¿™å¯¹ipã€portæ˜¯é›†ç¾¤å…¶ä»–èŠ‚ç‚¹ä¸è‡ªå·±é€šè®¯ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯å¤–éƒ¨å¯ä»¥è®¿é—®åˆ°çš„ipå’Œç«¯å£ã€‚ä¸Šè¾¹çš„BindAddrã€BindPortï¼ˆegï¼Œâ€0.0.0.0â€ã€â€˜7946â€™ï¼‰æ˜¯æœ¬åœ°ç›‘å¬çš„ipå’Œç«¯å£ï¼Œä½†å®é™…æœ¬æœºçš„å‡ºå£åœ°å€æ˜¯192.168.1.100:7946ï¼Œé‚£ä¹ˆAdvertiseAddråº”è¯¥æ˜¯192.168.1.100ï¼ŒAdvertisePortæ˜¯7946ï¼Œå¦åˆ™å…¶ä»–èŠ‚ç‚¹ä¸çŸ¥é“ä½ çš„çœŸå®ipã€‚å¯èƒ½å¸¦æ¥è¯¯è§£è¿™ä¸ªåˆè¦æ ¹æ®AdvertiseAddrã€AdvertisePortåœ¨æœ¬åœ°å¯ä¸€ä¸ªä»€ä¹ˆæœåŠ¡ï¼Œå…¶å®ä¸æ˜¯ã€‚é»˜è®¤æ˜¯ç©ºï¼Œmemberlistä¼šè§£æåˆ°èŠ‚ç‚¹ç»‘å®šçš„ipå’Œportï¼Œnatè½¬æ¢åçš„ipå’Œportã€‚</li>
  <li>ProtocolVersionï¼šåè®®ç‰ˆæœ¬ï¼Œç°åœ¨æœ‰äº”ä¸ªç‰ˆæœ¬ï¼Œå·®åˆ«ä¸å¤§ï¼Œä¾‹å¦‚v3åŠ äº†tcp  ping ï¼Œv4æ”¯æŒé—´æ¥pingã€‚é»˜è®¤ä½¿ç”¨v2ç‰ˆæœ¬ã€‚</li>
  <li>TCPTimeoutï¼šå»ºç«‹tcpé“¾æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œæ ¹æ®ç½‘ç»œæƒ…å†µé…ç½®å³å¯ã€‚</li>
  <li>IndirectChecksï¼šv4åè®®æ”¯æŒé—´æ¥æ¢æµ‹ã€‚å½“èŠ‚ç‚¹å¯åŠ¨ä¹‹åï¼Œæ¯ä¸ªä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œä¼šé€‰å–ä¸€ä¸ªèŠ‚ç‚¹å¯¹å…¶å‘é€ä¸€ä¸ªPINGï¼ˆUDPï¼‰æ¶ˆæ¯ï¼Œå½“PINGæ¶ˆæ¯å¤±è´¥åï¼Œä¼šéšæœºé€‰å–IndirectChecksä¸ªèŠ‚ç‚¹å‘èµ·é—´æ¥çš„PINGã€‚</li>
  <li>RetransmitMultï¼šå¹¿æ’­é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å‘é€å¤±è´¥è¶…è¿‡ä¸€å®šæ¬¡æ•°åï¼Œæ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚RetransmitMultå°±æ˜¯ç”¨ç®—é‡ä¼ æ¬¡æ•°çš„ï¼ŒRetransmits = RetransmitMult * log(N+1)ã€‚</li>
  <li>SuspicionMaxTimeoutMultã€SuspicionMultï¼šæ¢æµ‹æŸä¸ªèŠ‚ç‚¹è¶…æ—¶åï¼Œä¼šå°†æ”¹èŠ‚ç‚¹æ ‡è®°ä¸ºâ€œsuspectâ€èŠ‚ç‚¹ã€‚èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºâ€œsuspectâ€åï¼Œæœ¬åœ°å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå‘å‡ºä¸€ä¸ªâ€œsuspectâ€å¹¿æ’­ï¼Œåœ¨ä¸€æ®µæ—¶é—´è¢«å¦‚æœæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹å‘é€è¿‡æ¥çš„â€œsuspectâ€æ¶ˆæ¯ï¼Œå°±å°†æœ¬åœ°çš„â€œsuspectâ€ç¡®è®¤æ•°åŠ 1ï¼Œå½“ç¡®è®¤æ•°è¾¾åˆ°è¦æ±‚ä¹‹åå¹¶ä¸”è¯¥èŠ‚ä¾æ—§ä¸æ˜¯aliveçŠ¶æ€ï¼Œä¼šå°†è¯¥èŠ‚ç‚¹æ ‡è®°deadã€‚è¿™ä¸ªæ—¶é—´è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š
1.SuspicionTimeout = SuspicionMult * log(N+1) * ProbeInterval
2.SuspicionMaxTimeout = SuspicionMaxTimeoutMult * SuspicionTimeout
è¿™ä¸¤ä¸ªå€¼ä¸€èˆ¬ä¹Ÿä¸è¦æˆ‘ä»¬é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å³å¯ã€‚</li>
  <li>PushPullIntervalï¼šæ¯éš”PushPullIntervalæ—¶é—´é—´éš”ï¼Œéšæœºé€‰å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè·Ÿå®ƒå»ºç«‹tcpè¿æ¥ï¼Œç„¶åå°†æœ¬èŠ‚ç‚¹çš„å…¨éƒ¨çŠ¶æ€é€šè¿‡tcpä¼ åˆ°å¯¹æ–¹ï¼Œå¯¹æ–¹ä¹ŸæŠŠä»–çš„çŠ¶æ€å“åº”å›æ¥ï¼Œè¿›è¡ŒçŠ¶æ€åŒæ­¥ã€‚æ ¹æ®ç½‘ç»œæƒ…å†µè¿›è¡Œè°ƒæ•´å³å¯ã€‚</li>
  <li>ProbeIntervalã€ProbeTimeoutï¼šæ¢é’ˆé—´éš”å’Œï¼Œæ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚æ ¹æ®ç½‘ç»œæƒ…å†µè¿›è¡Œè°ƒæ•´å³å¯ã€‚</li>
  <li>DisableTcpPingsï¼šå…³é—­tcp pingã€‚è¿™ä¸ªå‚æ•°ä¸€èˆ¬ä¹Ÿä¸ç”¨ç®¡å®ƒã€‚</li>
  <li>AwarenessMaxMultiplierï¼šåœ¨èŠ‚ç‚¹è®¤ä¸ºè‡ªå·±ä¸èƒ½å¯é çš„æ¢æµ‹å…¶ä»–èŠ‚ç‚¹æ—¶ï¼Œä¼šæ ¹æ®è¿™ä¸ªå‚æ•°å¢åŠ æ¢æµ‹é—´éš”ã€‚ä¸€èˆ¬ä½¿ç”¨é»˜è®¤é…ç½®å³å¯ã€‚</li>
  <li>GossipIntervalï¼šæ£€æŸ¥å¹¿æ’­é˜Ÿåˆ—æ˜¯å¦æœ‰æ•°æ®éœ€è¦å‘é€ç»™å…¶ä»–èŠ‚ç‚¹çš„æ—¶é—´</li>
  <li>GossipNodesï¼šæ¯æ¬¡ç»™å‡ ä¸ªèŠ‚ç‚¹æ‰©æ•£æ•°æ®</li>
  <li>GossipToTheDeadTimeï¼šåœ¨è¿™ä¸ªæ—¶é—´å†…ä»ç„¶ä¼šå°è¯•ç»™DeadçŠ¶æ€çš„èŠ‚ç‚¹å‘é€æ•°æ®ã€‚ä½¿ç”¨é»˜è®¤é…ç½®å³å¯</li>
  <li>GossipVerifyIncomingã€GossipVerifyOutgoingï¼ŒSecretKeyã€Keyringï¼šåŠ å¯†ç®—æ³•å’Œç§˜é’¥ï¼ˆSecretKeyã€Keyringï¼‰ç¡®å®šæ˜¯å¦å¯¹ç½‘ç»œä¸Šçš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚GossipVerifyIncomingã€GossipVerifyOutgoingä¸ºtrueçš„ä½œç”¨æ˜¯å¦‚æœåŠ å¯†å¤±è´¥åˆ™æŠ¥é”™ï¼Œä¸ºfalseè¡¨ç¤ºåŠ å¯†å¤±è´¥åˆ™æ˜æ–‡ä¼ è¾“ã€‚</li>
  <li>EnableCompression ï¼šæ˜¯å¦æ•°æ®å‹ç¼©ï¼Œé»˜è®¤æ˜¯trueï¼Œå¯ä»¥å‡å°‘è´·æ¬¾ã€‚æ ¹æ®éœ€è¦é…ç½®</li>
  <li>DNSConfigPathï¼šæŒ‡å‘ç³»ç»Ÿçš„DNSé…ç½®æ–‡ä»¶ï¼Œlinuxå°±æ˜¯â€œ/etc/resolv.confâ€</li>
  <li>LogOutputã€Loggerï¼šå¯ä»¥å®šä¹‰memerlistçš„æ—¥å¿—è¾“å‡ºæ–¹å¼</li>
  <li>HandoffQueueDepthï¼šå¹¿æ’­é˜Ÿåˆ—çš„å¤§å°ï¼Œé»˜è®¤1024ï¼ŒåŸºæœ¬è¶³å¤Ÿï¼Œä¸éœ€è¦æ”¹åŠ¨ã€‚</li>
  <li>DeadNodeReclaimTimeï¼šå¦‚æœé…ç½®äº†ï¼ŒåŠ å…¥èŠ‚ç‚¹å¤„äºdeadçŠ¶æ€ï¼ŒDeadNodeReclaimTimeæ—¶é—´èŒƒå›´å†…å…è®¸ç›¸åŒèŠ‚ç‚¹nameç›¸åŒï¼Œä½†ipã€portä¸åŒçš„çŠ¶æ€å¯¹å…¶æ›´æ–°ã€‚é»˜è®¤æ˜¯0ï¼Œå¦‚æœå‘ç”Ÿä¸Šè¿°ç°è±¡åˆ™å‘ç”Ÿå†²çªã€‚ä¸ç†è§£æ²¡å…³ç³»ï¼Œä¸é…ç½®å°±å¯ä»¥äº†ã€‚
    <h5 id="ä»£ç†">ä»£ç†</h5>
  </li>
  <li>
    <p>Delegateï¼šè¿™ä¸ªæ¥å£ä¸€å®šè¦å®ç°çš„ï¼ŒåŒæ­¥ä¸šåŠ¡æ•°æ®é çš„å°±æ˜¯è¿™ä¸ªæ¥å£ã€‚
1ã€NotifyMsg([]byte)ï¼šæ¯å½“ç”¨æˆ·æœ‰æ–°æ•°æ®åŠ åˆ°å¹¿æ’­é˜Ÿåˆ—æ—¶ï¼Œå›è°ƒæ­¤æ–¹æ³•é€šçŸ¥å…¶ä»–èŠ‚ç‚¹åŒæ­¥çŠ¶æ€
2ã€LocalState(join bool) []byteã€MergeRemoteState(buf []byte, join bool)ï¼šæ¯éš”PushPullInterval å‘¨æœŸï¼Œæœ¬åœ°memberlistå›è°ƒLocalStateæ–¹æ³•ï¼ŒæŠŠæœ¬åœ°å…¨éƒ¨æ•°æ®å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹ï¼›å…¶ä»–èŠ‚ç‚¹memberlistå›è°ƒMergeRemoteStateï¼Œæ¥å—æ•°æ®è¿›è¡ŒåŒæ­¥ã€‚
å¤§å®¶æ³¨æ„ä¸‹ä¸Šé¢ä¸¤è€…çš„åŒºåˆ«ï¼Œä¸€ä¸ªæ•°æ–°å¢æ•°æ®çš„å¹¿æ’­ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡tcpå…¨é‡æ•°æ®åŒæ­¥ï¼ˆåŠ å¿«èŠ‚ç‚¹åŒæ­¥çŠ¶æ€ï¼›åŠ å¼ºä¸€è‡´æ€§ä¿éšœï¼‰ã€‚</p>
  </li>
  <li>DelegateProtocolVersionã€DelegateProtocolMinã€DelegateProtocolMaxï¼šä¸šåŠ¡çº§åˆ«çš„Delegateç‰ˆæœ¬æ§åˆ¶ï¼ŒåŸºæœ¬ä¹Ÿç”¨ä¸åˆ°ã€‚ä»€ä¹ˆæ—¶å€™æ„Ÿè§‰è‡ªå·±éœ€è¦ä¸ªè¿™ä¸œè¥¿ï¼Œå›å¤´åœ¨çœ‹è§å°±è¡Œã€‚</li>
  <li>Eventsï¼šEventsä»£ç†ï¼ŒèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€ç¦»å¼€ã€æ›´æ–°æ—¶é€šçŸ¥ä¸šåŠ¡å±‚ï¼Œä¿å­˜èŠ‚ç‚¹çŠ¶æ€å¯ä»¥ç”¨æ¥é“¾æ¥é‡è¿ä¹‹ç±»çš„å·¥ä½œã€‚</li>
  <li>Pingï¼špingä»£ç†ç”¨æ¥é€šçŸ¥ä¸šåŠ¡å±‚ï¼Œä¸€æ¬¡pingçš„ttlï¼Œå¦‚æœéœ€è¦æ‰“ç‚¹ç›‘æ§çš„è¯ï¼Œå¯ä»¥å®ç°ä¸‹ï¼Œå¦åˆ™ä¸éœ€è¦å®ç°ã€‚</li>
  <li>Aliveï¼šæ”¶åˆ°Aliveé€šçŸ¥åé€šçŸ¥ä¸šåŠ¡å±‚ï¼Œå¦‚æœéœ€è¦æ‰“ç‚¹ç›‘æ§çš„è¯ï¼Œå¯ä»¥å®ç°ä¸‹ï¼Œå¦åˆ™ä¸éœ€è¦å®ç°ã€‚</li>
  <li>Mergeï¼šè¿™ä¸ªä»£ç†æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨ï¼Œæ…¢æ…¢å‘ç°å§ã€‚
    <h1 id="æœ€å">æœ€å</h1>
    <p>å“ªé‡Œæœ‰é—®é¢˜ï¼Œè¿˜è¯·å¤§å®¶å¤šå¤šæŒ‡æ­£</p>
    <h1 id="å‚è€ƒ">å‚è€ƒ</h1>
    <p><a href="https://www.consul.io/docs/internals/gossip.html">https://www.consul.io/docs/internals/gossip.html</a>
<a href="https://en.wikipedia.org/wiki/Gossip_protocol">https://en.wikipedia.org/wiki/Gossip_protocol</a>
<a href="https://github.com/asim/memberlist">https://github.com/asim/memberlist</a>
<a href="https://github.com/hashicorp/memberlist">https://github.com/hashicorp/memberlist</a>
<a href="https://zhuanlan.zhihu.com/p/41228196">https://zhuanlan.zhihu.com/p/41228196</a></p>
  </li>
</ul>
:ET